<ion-header class="ion-no-border">
  <ion-toolbar color="white">
    <ion-title slot="start"><b>Agenda</b></ion-title>

    <ion-buttons slot="end">
  <ion-button (click)="showFakeNotif()">
    <ion-icon name="notifications-outline"></ion-icon>
    <!-- badge toujours visible -->
    <ion-badge class="notif-badge">1</ion-badge>
  </ion-button>

  <ion-item lines="none">
    <ion-avatar slot="start" style="width: 30px; height: 30px;">
      <img src="https://ionicframework.com/docs/img/demos/avatar.svg" />
    </ion-avatar>
    <ion-label>
      <h2>Profil</h2>
    </ion-label>
  </ion-item>
</ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content class="bg-gray">
  <ion-grid>
    <ion-row>

      <!-- COLONNE GAUCHE : EMPLOI DU TEMPS -->
      <ion-col size="12" size-lg="9" class="calendar-col">

        <div class="calendar-top-header">
          <h2>Semaine {{ currentWeek }}</h2>
          <ion-button (click)="goToday()" color="primary" shape="round">
            Aujourd'hui
          </ion-button>
        </div>

        <div class="card-white">
          <full-calendar #myCalendar [options]="calendarOptions"></full-calendar>
        </div>

      </ion-col>

      <!-- COLONNE DROITE : PANNEAU -->
      <ion-col size="12" size-lg="3" class="side-col">

        <!-- Switch + Mini calendrier -->
        <div class="card-white">

          <div class="view-switch">
            <ion-segment [(ngModel)]="viewMode" (ionChange)="onViewModeChange()">
              <ion-segment-button value="student">
                <ion-label>Étudiant</ion-label>
              </ion-segment-button>
              <ion-segment-button value="room">
                <ion-label>Salle</ion-label>
              </ion-segment-button>
            </ion-segment>
          </div>

          <ion-datetime
            presentation="date"
            color="primary"
            [value]="selectedDate"
            (ionChange)="changeDate($event)">
          </ion-datetime>

        </div>

        <!-- Bloc dynamique : Étudiant / Salle -->
        <div class="card-white" style="margin-top: 15px;">

          <!-- MODE ÉTUDIANT -->
          <ng-container *ngIf="viewMode === 'student'">

            <div class="filter-header">
              <h3>Liste des cours</h3>
              <ion-button fill="clear" size="small" (click)="openSettings()">
                <ion-icon name="settings-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>

            <ion-list lines="none">
              <ion-item
                *ngFor="let c of courses"
                class="course-item"
                [ngStyle]="{
                  '--checkbox-bg': c.colorFill,
                  '--checkbox-border': c.colorBorder || c.colorFill
                }"
              >
                <ion-checkbox
                  slot="start"
                  mode="md"
                  [(ngModel)]="c.checked"
                  (ionChange)="onCourseToggle(c)"
                  class="course-checkbox"
                ></ion-checkbox>

                <ion-label>{{ c.name }}</ion-label>
              </ion-item>
            </ion-list>

          </ng-container>

          <!-- MODE SALLE -->
          <ng-container *ngIf="viewMode === 'room'">

            <div class="filter-header">
              <h3>Liste des salles</h3>
              <ion-badge *ngIf="selectedRoom" class="room-badge">
                {{ selectedRoom }}
              </ion-badge>
            </div>

            <ion-searchbar
              class="room-search"
              placeholder="Rechercher…"
              [(ngModel)]="roomQuery"
              (ionInput)="filterRooms()"
              debounce="200">
            </ion-searchbar>

            <div class="room-list">
              <ion-list lines="none">
                <ion-item
                  button
                  *ngFor="let r of filteredRooms"
                  class="room-item"
                  [class.active]="r === selectedRoom"
                  (click)="selectRoom(r)"
                >
                  <ion-icon name="business-outline" slot="start"></ion-icon>
                  <ion-label>{{ r }}</ion-label>
                </ion-item>
              </ion-list>
            </div>

          </ng-container>

        </div>

      </ion-col>

    </ion-row>
  </ion-grid>
</ion-content>
